<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slab Design Calculator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .input-field {
            flex: 1 1 300px;
        }
        .input-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-field input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #results {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr.best-cost {
            background-color: #d4efdf !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Slab Design Calculator</h1>
        <div class="input-group">
            <div class="input-field">
                <label for="longerSpan">Longer Span (m):</label>
                <input type="number" id="longerSpan" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="shorterSpan">Shorter Span (m):</label>
                <input type="number" id="shorterSpan" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="liveLoad">Live Load (kN/m²):</label>
                <input type="number" id="liveLoad" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="floorFinish">Floor Finish (kN/m²):</label>
                <input type="number" id="floorFinish" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="mainBarDia">Main Bar Diameter (mm):</label>
                <input type="number" id="mainBarDia" required>
            </div>
            <div class="input-field">
                <label for="distBarDia">Distribution Bar Diameter (mm):</label>
                <input type="number" id="distBarDia" required>
            </div>
            <div class="input-field">
                <label for="sandRate">Sand Rate (per ton):</label>
                <input type="number" id="sandRate" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="aggregateRate">Aggregate Rate (per ton):</label>
                <input type="number" id="aggregateRate" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="cementRate">Cement Rate (per 50kg bag):</label>
                <input type="number" id="cementRate" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="steelFe415Rate">Steel Fe415 Rate (per kg):</label>
                <input type="number" id="steelFe415Rate" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="steelFe500Rate">Steel Fe500 Rate (per kg):</label>
                <input type="number" id="steelFe500Rate" step="0.01" required>
            </div>
            <div class="input-field">
                <label for="steelFe550Rate">Steel Fe550 Rate (per kg):</label>
                <input type="number" id="steelFe550Rate" step="0.01" required>
            </div>
        </div>
        <button onclick="calculateSlabDesign()">Calculate</button>
        <div id="results"></div>
    </div>

    <script>
        const fckValues = [20, 25, 30];
        const fyValues = [415, 500, 550];
        const widthSupports = 0.23; // meters
        const barWeights = { 8: 0.395, 10: 0.617, 12: 0.89, 16: 1.58 };
        const tauTable = {
            0.15: { 'M15': 0.28, 'M20': 0.28, 'M25': 0.29, 'M30': 0.29, 'M35': 0.29, 'M40+': 0.30 },
            0.25: { 'M15': 0.35, 'M20': 0.36, 'M25': 0.36, 'M30': 0.37, 'M35': 0.37, 'M40+': 0.38 },
            0.50: { 'M15': 0.46, 'M20': 0.48, 'M25': 0.49, 'M30': 0.50, 'M35': 0.50, 'M40+': 0.51 },
            0.75: { 'M15': 0.54, 'M20': 0.56, 'M25': 0.57, 'M30': 0.59, 'M35': 0.59, 'M40+': 0.60 },
            1.00: { 'M15': 0.60, 'M20': 0.62, 'M25': 0.64, 'M30': 0.66, 'M35': 0.67, 'M40+': 0.68 },
            1.25: { 'M15': 0.64, 'M20': 0.67, 'M25': 0.70, 'M30': 0.71, 'M35': 0.73, 'M40+': 0.74 },
            1.50: { 'M15': 0.68, 'M20': 0.72, 'M25': 0.74, 'M30': 0.76, 'M35': 0.78, 'M40+': 0.79 },
            1.75: { 'M15': 0.71, 'M20': 0.75, 'M25': 0.78, 'M30': 0.80, 'M35': 0.82, 'M40+': 0.84 },
            2.00: { 'M15': 0.71, 'M20': 0.79, 'M25': 0.82, 'M30': 0.84, 'M35': 0.86, 'M40+': 0.88 },
            2.25: { 'M15': 0.71, 'M20': 0.81, 'M25': 0.85, 'M30': 0.88, 'M35': 0.90, 'M40+': 0.92 },
            2.50: { 'M15': 0.71, 'M20': 0.82, 'M25': 0.88, 'M30': 0.91, 'M35': 0.93, 'M40+': 0.95 },
            2.75: { 'M15': 0.71, 'M20': 0.82, 'M25': 0.90, 'M30': 0.94, 'M35': 0.96, 'M40+': 0.98 },
            3.00: { 'M15': 0.71, 'M20': 0.82, 'M25': 0.92, 'M30': 0.96, 'M35': 0.99, 'M40+': 1.01 }
        };

        function calculateShearStrength(Asbd_100, grade) {
            let gradeKey = grade < 40 ? `M${grade}` : 'M40+';
            if (Asbd_100 <= 0.15) return tauTable[0.15][gradeKey];
            if (Asbd_100 >= 3.00) return tauTable[3.00][gradeKey];
            let keys = Object.keys(tauTable).map(Number).sort((a, b) => a - b);
            for (let i = 1; i < keys.length; i++) {
                let lower = keys[i - 1], upper = keys[i];
                if (lower < Asbd_100 && Asbd_100 < upper) {
                    let tauLower = tauTable[lower][gradeKey];
                    let tauUpper = tauTable[upper][gradeKey];
                    return Number((tauLower + (Asbd_100 - lower) * (tauUpper - tauLower) / (upper - lower)).toFixed(3));
                }
            }
            return tauTable[Asbd_100][gradeKey];
        }

        function calculateSlabDesign() {
            // Get input values
            const longerSpan = Number(document.getElementById('longerSpan').value);
            const shorterSpan = Number(document.getElementById('shorterSpan').value);
            const liveLoad = Number(document.getElementById('liveLoad').value);
            const floorFinish = Number(document.getElementById('floorFinish').value);
            const mainBarDia = Number(document.getElementById('mainBarDia').value);
            const distBarDia = Number(document.getElementById('distBarDia').value);
            const rateSand = Number(document.getElementById('sandRate').value);
            const rateAggregate = Number(document.getElementById('aggregateRate').value);
            const rateCement = Number(document.getElementById('cementRate').value);
            const rateSteel415 = Number(document.getElementById('steelFe415Rate').value);
            const rateSteel500 = Number(document.getElementById('steelFe500Rate').value);
            const rateSteel550 = Number(document.getElementById('steelFe550Rate').value);

            let results = [];
            for (let fck of fckValues) {
                for (let fy of fyValues) {
                    let aspectRatio = longerSpan / shorterSpan;
                    let slabType = aspectRatio > 2 ? "One Way" : "Two Way";
                    let effectiveDepthD = 125;
                    let effectiveCover = 25;
                    let totalDepth = Math.round((effectiveDepthD + effectiveCover) * 100) / 100;

                    let effectiveSpan = Math.round(Math.min(shorterSpan + effectiveDepthD / 1000, shorterSpan + widthSupports) * 100) / 100;
                    let deadLoadSlab = Math.round((totalDepth / 1000 * 25) * 100) / 100;
                    let deadLoadFloorFinish = Math.round(floorFinish * 100) / 100;
                    let totalDeadLoadSlab = Math.round((deadLoadSlab + deadLoadFloorFinish) * 100) / 100;
                    let wu = Math.round((1.5 * (totalDeadLoadSlab + liveLoad)) * 100) / 100;

                    let mu = Math.round((wu * effectiveSpan * effectiveSpan / 8) * 100) / 100;
                    let vu = Math.round((wu * effectiveSpan / 2) * 100) / 100;
                    let mulim = fy === 415 ? 0.138 : (fy === 500 ? 0.133 : 0.130);
                    mulim = Math.round((mulim * fck * 1000 * (effectiveDepthD * effectiveDepthD) / 1e6) * 100) / 100;

                    if (mulim <= mu) continue;

                    let astMain = Math.round((0.5 * fck / fy * (1 - Math.sqrt(1 - (4.6 * mu * 1e6) / (fck * 1000 * effectiveDepthD * effectiveDepthD))) * 1000 * effectiveDepthD) * 100) / 100;
                    let astMin = Math.round((0.0012 * 1000 * totalDepth) * 100) / 100;

                    let areaOneMainBar = Math.round((Math.PI / 4 * mainBarDia * mainBarDia) * 100) / 100;
                    let spacingMainBar = Math.round((1000 * areaOneMainBar / astMain / 10)) * 10;
                    let adoptSpacingMain = Math.floor(Math.min(3 * effectiveDepthD, 300, spacingMainBar) / 10) * 10;
                    let astMainProvided = Math.round((1000 * areaOneMainBar / adoptSpacingMain) * 100) / 100;

                    let areaOneDistBar = Math.round((Math.PI / 4 * distBarDia * distBarDia) * 100) / 100;
                    let spacingDistBar = Math.ceil((1000 * areaOneDistBar / astMin / 10)) * 10;
                    let adoptSpacingDist = Math.floor(Math.min(5 * effectiveDepthD, 450, spacingDistBar) / 10) * 10;
                    let astDistProvided = Math.round((1000 * areaOneDistBar / adoptSpacingDist) * 100) / 100;

                    let tv = Math.round((vu * 1000 / (1000 * effectiveDepthD)) * 100) / 100;
                    let pt = Math.round((100 * astMainProvided / (1000 * effectiveDepthD)) * 100) / 100;
                    let tauC = calculateShearStrength(pt, fck);
                    let designShearStrength = Number((tauC * 1.30).toFixed(3));
                    if (tv > designShearStrength) continue;
                    let shearCheck = "Safe";

                    let numMainBars = Math.ceil((longerSpan * 1000) / adoptSpacingMain) + 1;
                    let mainSteelMeters = numMainBars * shorterSpan;
                    let mainBarWeight = barWeights[mainBarDia] || 0.395;
                    let mainBarKgs = mainSteelMeters * mainBarWeight;

                    let numDistBars = Math.ceil((shorterSpan * 1000) / adoptSpacingDist) + 1;
                    let distSteelMeters = numDistBars * longerSpan;
                    let distBarWeight = barWeights[distBarDia] || 0.395;
                    let distBarKgs = distSteelMeters * distBarWeight;

                    let totalSteelWeight = Math.round((mainBarKgs + distBarKgs) * 100) / 100;

                    let totalDepthM = Math.round((totalDepth / 1000) * 100) / 100;
                    let volumeWetConcrete = Math.round((longerSpan * shorterSpan * totalDepthM) * 100) / 100;
                    let volumeDryConcrete = Math.round((volumeWetConcrete * 1.54) * 100) / 100;

                    let ratios = fck === 20 ? [1, 1.5, 3] : (fck === 25 ? [1, 1, 2] : [1, 0.75, 1.5]);
                    let totalRatio = ratios.reduce((a, b) => a + b, 0);
                    let volumeCement = Math.round((ratios[0] * volumeDryConcrete / totalRatio) * 100) / 100;
                    let volumeSand = Math.round((ratios[1] * volumeDryConcrete / totalRatio) * 100) / 100;
                    let volumeAggregate = Math.round((ratios[2] * volumeDryConcrete / totalRatio) * 100) / 100;

                    let cementInKg = Math.round((volumeCement * 1440) * 100) / 100;
                    let numCementBags = Math.round((cementInKg / 50) * 100) / 100;
                    let sandInTon = Math.round((volumeSand * 1600 / 1000) * 100) / 100;
                    let aggregateInTon = Math.round((volumeAggregate * 1450 / 1000) * 100) / 100;

                    let priceCement = Math.round((numCementBags * rateCement) * 100) / 100;
                    let steelRate = fy === 415 ? rateSteel415 : (fy === 500 ? rateSteel500 : rateSteel550);
                    let priceSteel = Math.round((totalSteelWeight * steelRate) * 100) / 100;
                    let priceSand = Math.round((sandInTon * rateSand) * 100) / 100;
                    let priceAggregate = Math.round((aggregateInTon * rateAggregate) * 100) / 100;
                    let totalPrice = Math.round((priceCement + priceSteel + priceSand + priceAggregate) * 100) / 100;

                    results.push([fck, fy, slabType, totalDepth, mulim, mainBarDia, adoptSpacingMain, distBarDia, adoptSpacingDist, shearCheck, totalSteelWeight, numCementBags, sandInTon, aggregateInTon, totalPrice]);
                }
            }

            // Display results
            const columns = ["Fck", "Fy", "Slab Type", "Total Depth", "Ultimate Moment of Resistance", "Main Bar Dia", "Main Bar Spacing", "Dist Bar Dia", "Dist Bar Spacing", "Shear Check", "Total Steel Weight", "No of Cement Bags", "Sand in Tons", "Aggregate in Tons", "Total Price"];
            let html = '<table><thead><tr>' + columns.map(col => `<th>${col}</th>`).join('') + '</tr></thead><tbody>';
            let minPrice = Math.min(...results.map(r => r[14]));
            results.forEach(row => {
                let isBestCost = row[14] === minPrice;
                html += `<tr${isBestCost ? ' class="best-cost"' : ''}>` + row.map(cell => `<td>${cell}</td>`).join('') + '</tr>';
            });
            html += '</tbody></table>';
            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>
